# security-hub-to-jira
Script to query AWS Security Hub findings and create or update Jira issues

This script exports security hub findings, filtered by AWS account and severity.
It then creates or updates Jira issues for the findings, combining common findings
into a single Jira issue: For `Config` findings it creates one issue per account
and vulnerability, listing the affected AWS resources in the issue description. For 
`Inspector` findings it creates one issue per account and AWS resource, listing
the vulnerabilities in the issue description.  Moreover when resources have `Name`
attributes, resources with a common names are grouped into one Jira issue for 
`Inspector` findings. The `summary` (title) of the description
is the concatenation of the AWS account ID and the vulnerability (for `Config`) or
resource (for `Inspector`).  The script treats the `summary` field as a unique key.

The script adds labels `security-hub` and `auto-generated` to each issue it creates,
and only updates issues having these labels. This helps avoid collisions with other
issues whose summaries happen to match the ones generated by this script.  Issues
are created in the Jira project you specify, though they can be moved around after creation
without causing problems when this script is run in the future. The script is idempotent:
Existing issues are updated with the latest list of affected resources / vulnerabilities but if the
existing Jira issue matches the content retrieved from SecurityHub then no change is made.

The script requires AWS and Jira credentials. AWS credentials should be placed in
`~/.aws/credentials` under a section titled, `[security-account]`.  It's recommended
to use an STS token.  Jira credentials are set as environment variables, 
`JIRA_USER_EMAIL_ADDRESS` and`JIRA_API_TOKEN`.  For details on getting Jira credentials,
see [your security settings](https://id.atlassian.com/manage-profile/security/api-tokens).

###Arguments

--account, -a: comma separated list of numerical AWS account IDs

--severity, -s: command separated lis of SecuirtyHub severity labels

--jira_project, -p: the Jira project used to create new issues

--dryrun, -d:  do not create or update any Jira issues

--verbose, -v: with `dryrun`, show the description of the issue to be created


Example:

```
python3 security-hub-to-jira.py --account 325565585839,383874245509 --severity CRITICAL,HIGH --jira_project IT --dryrun --verbose

```

